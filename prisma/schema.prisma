generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model detalle_mantenimiento {
  id_detalle         Int             @id @default(autoincrement())
  tipo_mantenimiento String          @db.VarChar(50)
  nombre_detalle     String          @db.VarChar(255)
  mantenimiento      mantenimiento[]
}

model mantenimiento {
  costomant             Float?
  detalle_id            Int?
  fechamant             DateTime?              @db.Date
  idmant                Int                    @id @default(autoincrement())
  idprop                Int?
  idres                 Int?
  idveh                 Int?
  descripcion           String?                @db.VarChar(255)
  detalle_mant          String?                @db.VarChar(255)
  fotomant              String?                @db.VarChar(255)
  otro_detalle          String?                @db.VarChar(255)
  tipomant              String?                @db.VarChar(255)
  vehiculo              vehiculo?              @relation(fields: [idveh], references: [idveh], onDelete: NoAction, onUpdate: NoAction, map: "fk2dk91k5354wh67qyeowvellkr")
  detalle_mantenimiento detalle_mantenimiento? @relation(fields: [detalle_id], references: [id_detalle], onDelete: NoAction, onUpdate: NoAction, map: "fkcmorx1ksf7bco8veasvfnaq87")
  reserva               reserva?               @relation(fields: [idres], references: [idres], onDelete: NoAction, onUpdate: NoAction, map: "fkdke8r86me481asmu7ygnov05t")
  usuario               usuario?               @relation(fields: [idprop], references: [idprop], onDelete: NoAction, onUpdate: NoAction, map: "fkis0owv6xp5ipmv21ki0mw1ah6")
}

/// Reserva con estado tipado por enum (PENDIENTE, CONFIRMADA, FINALIZADA, CANCELADA).
model reserva {
  costo             Int?
  idcli             Int?
  idres             Int             @id @default(autoincrement())
  idveh             Int?
  fechafin          DateTime?       @db.Timestamp(6)
  fechafinalizacion DateTime?       @db.Timestamp(6)
  fechainicio       DateTime?       @db.Timestamp(6)
  fechares          DateTime?       @db.Timestamp(6)
  estado            EstadoReserva?  @default(PENDIENTE)
  
  // Campos de auditoría
  created_at        DateTime        @default(now())
  updated_at        DateTime        @default(now()) @updatedAt
  created_by        Int?
  updated_by        Int?
  deleted_at        DateTime?       // Soft delete
  deleted_by        Int?
  
  mantenimiento     mantenimiento[]
  usuario           usuario?        @relation("ClienteReservas", fields: [idcli], references: [idprop], onDelete: NoAction, onUpdate: NoAction, map: "fkhcb7l9qoy85ndceeubthuid7g")
  vehiculo          vehiculo?       @relation(fields: [idveh], references: [idveh], onDelete: NoAction, onUpdate: NoAction, map: "fkj2yfy568nnvlnkxm9k7329j4s")
}

/// Tablas de Better Auth (user, account, session, verification)
model user {
  id            String    @id @default(cuid())
  name          String?
  email         String    @unique
  emailVerified Boolean   @default(false)
  image         String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  rol           String?   @db.VarChar(255)
  nomprop       String?   @db.VarChar(255)
  apeprop       String?   @db.VarChar(255)
  dniprop       String?   @db.VarChar(255)
  account       account[]
  session       session[]
  usuario       usuario?
}

model session {
  id        String   @id @default(cuid())
  userId    String
  token     String   @unique
  expiresAt DateTime
  ipAddress String?
  userAgent String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      user     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model account {
  id                String   @id @default(cuid())
  userId            String
  accountId         String
  providerId        String
  accessToken       String?
  refreshToken      String?
  accessTokenExpiresAt DateTime?
  refreshTokenExpiresAt DateTime?
  scope             String?
  idToken           String?
  password          String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  user              user     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model verification {
  id         String   @id @default(cuid())
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model usuario {
  estprop              Boolean?
  idprop               Int                    @id @default(autoincrement())
  authUserId           String?                @unique
  apeprop              String?                @db.VarChar(255)
  dniprop              String?                @db.VarChar(255)
  emailprop            String?                @unique @db.VarChar(255)
  nomprop              String?                @db.VarChar(255)
  password             String?                @db.VarChar(255)
  rol                  String?                @db.VarChar(255)
  telefonoprop         String?                @db.VarChar(20)
  
  // Campos de auditoría
  created_at           DateTime               @default(now())
  updated_at           DateTime               @default(now()) @updatedAt
  created_by           Int?
  updated_by           Int?
  deleted_at           DateTime?              // Soft delete
  deleted_by           Int?
  
  mantenimiento        mantenimiento[]
  reserva              reserva[]              @relation("ClienteReservas")
  vehiculo             vehiculo[]
  vehiculos_eliminados vehiculos_eliminados[]
  authUser             user?                  @relation(fields: [authUserId], references: [id], onDelete: SetNull)
}

/// Vehículo: fotoveh e imagenUrl aceptan rutas locales o URLs externas (Text para URLs largas).
/// estveh usa el enum EstadoVehiculo (DISPONIBLE, OCUPADO, EN_MANTENIMIENTO, FUERA_SERVICIO).
model vehiculo {
  anioveh                Int?
  fecharegistro          DateTime?              @db.Date
  horas_uso              Float?
  idprop                 Int?
  idveh                  Int                    @id @default(autoincrement())
  peso                   Float?
  potencia               Float?
  precioalquilo          Float?
  requiere_certificacion Boolean?
  accesorios             String?                @db.VarChar(500)
  capacidad              String?                @db.VarChar(255)
  categoria              String?                @db.VarChar(255)
  dimensiones            String?                @db.VarChar(255)
  estveh                 EstadoVehiculo?
  fotoveh                String?                @db.Text
  imagenUrl              String?                @db.Text
  marveh                 String?                @db.VarChar(255)
  modveh                 String?                @db.VarChar(255) @unique
  plaveh                 String?                @db.VarChar(255)
  marca_id               Int?
  
  // Campos de auditoría
  created_at             DateTime               @default(now())
  updated_at             DateTime               @default(now()) @updatedAt
  created_by             Int?
  updated_by             Int?
  deleted_at             DateTime?              // Soft delete
  deleted_by             Int?
  
  mantenimiento          mantenimiento[]
  reserva                reserva[]
  usuario                usuario?               @relation(fields: [idprop], references: [idprop], onDelete: NoAction, onUpdate: NoAction, map: "fk2pu1225mw666tkb93d0dhd49v")
  vehiculos_eliminados   vehiculos_eliminados[]
}

model vehiculos_eliminados {
  fecharegistro DateTime @db.Date
  id            Int      @id @default(autoincrement())
  idprop        Int
  idveh         Int
  razon         String   @db.VarChar(255)
  vehiculo      vehiculo @relation(fields: [idveh], references: [idveh], onDelete: NoAction, onUpdate: NoAction, map: "fkqy7dvq9g8rcrd4c0lmperqxcb")
  usuario       usuario  @relation(fields: [idprop], references: [idprop], onDelete: NoAction, onUpdate: NoAction, map: "fksanpo3lbpuvrt9yxfhec1hsqm")
}

enum Rol {
  PROPIETARIO
  CLIENTE
  ADMINISTRADOR
}

enum EstadoVehiculo {
  DISPONIBLE
  OCUPADO
  EN_MANTENIMIENTO
  FUERA_SERVICIO
}

/// Estados de reserva simplificados (4 estados principales).
enum EstadoReserva {
  PENDIENTE
  CONFIRMADA
  FINALIZADA
  CANCELADA
}
